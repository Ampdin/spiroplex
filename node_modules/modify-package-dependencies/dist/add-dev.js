'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _lodash = require('lodash.find');

var _lodash2 = _interopRequireDefault(_lodash);

var _immutableObjectMethods = require('immutable-object-methods');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function (getNameAndVersion) {
  return function (packageJson, args) {
    return Promise.all(args.map(getNameAndVersion)).then(function (rows) {
      var errorRow = (0, _lodash2.default)(rows, function (_ref) {
        var name = _ref.name;

        return (0, _immutableObjectMethods.getIn)(packageJson, ['dependencies', name]);
      });

      if (errorRow) {
        return Promise.reject(new Error('"' + errorRow.name + '" is already in dependencies'));
      }

      var result = packageJson;
      rows.forEach(function (_ref2) {
        var name = _ref2.name;
        var version = _ref2.version;

        result = (0, _immutableObjectMethods.setIn)(result, ['devDependencies', name], version);
      });
      return Promise.resolve(result);
    });
  };
};