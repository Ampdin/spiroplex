'use strict';

var _registryUrl = require('registry-url');

var _registryUrl2 = _interopRequireDefault(_registryUrl);

var _registryAuthToken = require('registry-auth-token');

var _registryAuthToken2 = _interopRequireDefault(_registryAuthToken);

var _npmPackageArg = require('npm-package-arg');

var _npmPackageArg2 = _interopRequireDefault(_npmPackageArg);

var _got = require('got');

var _got2 = _interopRequireDefault(_got);

var _httpHttpsAgent = require('http-https-agent');

var _httpHttpsAgent2 = _interopRequireDefault(_httpHttpsAgent);

var _urlJoin = require('url-join');

var _urlJoin2 = _interopRequireDefault(_urlJoin);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var getAgent = (0, _httpHttpsAgent2.default)({
  keepAlive: true,
  maxSockets: 20
});

module.exports = function (packageName) {
  var opts = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];

  var _npa = (0, _npmPackageArg2.default)(packageName);

  var scope = _npa.scope;
  var escapedName = _npa.escapedName;
  var _opts$registry = opts.registry;
  var registry = _opts$registry === undefined ? (0, _registryUrl2.default)(scope) : _opts$registry;

  var _ref = (0, _registryAuthToken2.default)(registry) || {};

  var token = _ref.token;

  var url = (0, _urlJoin2.default)(registry, escapedName);

  var headers = token ? {
    authorization: 'Bearer ' + token
  } : {};
  var agent = getAgent(url);

  return (0, _got2.default)(url, { headers: headers, json: true, agent: agent }).then(function (_ref2) {
    var body = _ref2.body;
    return body;
  });
};